generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String                @id @default(cuid())
  email                String                @unique
  level                Int                   @default(1)
  xp                   Int                   @default(0)
  createdAt            DateTime              @default(now())
  image                String
  name                 String                @unique
  updatedAt            DateTime              @updatedAt
  clerkId              String                @unique
  challengeCompletions ChallengeCompletion[]
  sectionCompletions   SectionCompletion[]

  streak        Int       @default(0)
  lastStudiedAt DateTime?

  rank Rank @default(BEGINNER)
}

  streak        Int       @default(0)
  lastStudiedAt DateTime?

  rank Rank @default(BEGINNER)
}
enum Rank {
  BEGINNER
  JUNIOR
  MID
  SENIOR
  EXPERT
  MASTER
  LEGEND
}
model StudyPlan {
  id                   String                @id @default(cuid())
  title                String
  description          String
  img                  String
  challenges           Challenge[]
  challengeCompletions ChallengeCompletion[]
  sections             Section[]
  sectionCompletions   SectionCompletion[]
}

model Section {
  id          String              @id @default(cuid())
  title       String
  order       Int
  xp          Int                 @default(50)
  studyPlanId String
  exercises   Exercise[]
  studyPlan   StudyPlan           @relation(fields: [studyPlanId], references: [id])
  completions SectionCompletion[]
  subsections SubSection[]
}

model SectionCompletion {
  id          String    @id @default(cuid())
  userId      String
  studyPlanId String
  sectionId   String
  completedAt DateTime? @default(now())
  section     Section   @relation(fields: [sectionId], references: [id])
  studyPlan   StudyPlan @relation(fields: [studyPlanId], references: [id])
  user        User      @relation(fields: [userId], references: [id])

  @@unique([userId, sectionId])
}

model Challenge {
  id           String                @id @default(cuid())
  title        String
  description  String
  language     String
  difficulty   Difficulty
  xp           Int
  starterCode  String
  functionName String
  studyPlanId  String
  studyPlan    StudyPlan             @relation(fields: [studyPlanId], references: [id])
  completions  ChallengeCompletion[]
  testCases    TestCase[]
  examples     ChallengeExample[]
}

model ChallengeExample {
  id          String    @id @default(cuid())
  input       String
  output      String
  challengeId String
  challenge   Challenge @relation(fields: [challengeId], references: [id])
}

model TestCase {
  id          String    @id @default(cuid())
  input       Json
  output      Json
  challengeId String
  challenge   Challenge @relation(fields: [challengeId], references: [id])
}

model ChallengeCompletion {
  id          String    @id @default(cuid())
  userId      String
  studyPlanId String
  challengeId String
  completedAt DateTime? @default(now())
  challenge   Challenge @relation(fields: [challengeId], references: [id])
  studyPlan   StudyPlan @relation(fields: [studyPlanId], references: [id])
  user        User      @relation(fields: [userId], references: [id])

  @@unique([userId, challengeId])
}

model Exercise {
  id        String       @id @default(cuid())
  type      ExerciseType
  question  String
  answer    String
  sectionId String
  options   String[]
  section   Section      @relation(fields: [sectionId], references: [id])
}

model SubSection {
  id        String  @id @default(cuid())
  title     String
  content   String
  example   String
  sectionId String
  section   Section @relation(fields: [sectionId], references: [id])
}

enum ExerciseType {
  TRUE_FALSE
  MCQ
  FILL_BLANK
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum Rank {
  BEGINNER
  JUNIOR
  MID
  SENIOR
  EXPERT
  MASTER
  LEGEND
}
